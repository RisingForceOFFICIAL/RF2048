<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>RF2048</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --accent:#0ea5e9;--accent2:#67e8f9;
  --bg:#0a0a0a;--bg2:#111;--bg3:#1a1a1a;
  --text:#e5e5e5;--text2:#a3a3a3;
  --cell:#1e1e1e;--radius:12px;--gap:12px
}
.theme-light{--bg:#f5f5f5;--bg2:#e5e5e5;--bg3:#d4d4d4;--text:#171717;--text2:#525252;--cell:#ccc}
.theme-neon{--accent:#ff00ff;--accent2:#00ffff;--bg:#0a0014;--bg2:#140020;--bg3:#1e0030;--text:#fff;--text2:#c0c;--cell:#1a0028}
.theme-ocean{--accent:#00b4d8;--accent2:#90e0ef;--bg:#001220;--bg2:#001a2e;--bg3:#002842;--text:#caf0f8;--text2:#90e0ef;--cell:#002040}
.theme-sunset{--accent:#ff6b35;--accent2:#ffd166;--bg:#120800;--bg2:#1f0f00;--bg3:#2d1600;--text:#fff3e0;--text2:#ffb088;--cell:#261200}
.theme-forest{--accent:#4ade80;--accent2:#86efac;--bg:#001208;--bg2:#001f0e;--bg3:#002d14;--text:#dcfce7;--text2:#86efac;--cell:#00240f}
.theme-galaxy{--accent:#a855f7;--accent2:#e879f9;--bg:#08000f;--bg2:#10001a;--bg3:#180028;--text:#f3e8ff;--text2:#d8b4fe;--cell:#12001f}
.theme-retro{--accent:#facc15;--accent2:#fef08a;--bg:#0f0f0f;--bg2:#1a1a1a;--bg3:#262626;--text:#fafafa;--text2:#d4d4d8;--cell:#202020}

body{
  background:var(--bg);color:var(--text);
  font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:100dvh;overflow:hidden;transition:background .3s,color .3s;
  -webkit-user-select:none;user-select:none
}
.header{display:flex;align-items:center;justify-content:space-between;width:min(420px,90vw);margin-bottom:16px}
.logo{font-size:2.2rem;font-weight:900;letter-spacing:-1px}
.logo span{color:var(--accent)}
.scores{display:flex;gap:8px}
.score-box{background:var(--bg3);border-radius:8px;padding:8px 14px;text-align:center;min-width:70px}
.score-box .label{font-size:.6rem;color:var(--accent2);text-transform:uppercase;letter-spacing:1px}
.score-box .val{font-size:1.2rem;font-weight:700}

.controls{display:flex;align-items:center;justify-content:center;width:min(420px,90vw);margin-bottom:16px;gap:8px;flex-wrap:wrap}
.btn{
  background:var(--bg3);color:var(--text);border:none;
  border-radius:8px;padding:10px 16px;font-size:.8rem;font-weight:600;
  cursor:pointer;transition:background .2s,transform .1s
}
.btn:hover{background:var(--accent);color:#fff}
.btn:active{transform:scale(.95)}
.btn-icon{padding:10px 12px;font-size:1.1rem}

.board-wrap{
  position:relative;width:min(420px,90vw);aspect-ratio:1;
  background:var(--bg2);border-radius:var(--radius);
  padding:var(--gap);transition:background .3s
}
.board{
  display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);
  gap:var(--gap);width:100%;height:100%
}
.cell{background:var(--cell);border-radius:calc(var(--radius) - 2px)}

.tile-layer{position:absolute;top:var(--gap);left:var(--gap);right:var(--gap);bottom:var(--gap);pointer-events:none}
.tile{
  position:absolute;display:flex;align-items:center;justify-content:center;
  font-weight:800;border-radius:calc(var(--radius) - 2px);
  transition:top .12s ease-out,left .12s ease-out,width .12s,height .12s;
  will-change:top,left
}
.tile.pop{animation:pop .2s ease}
.tile.appear{animation:appear .2s ease}
@keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
@keyframes appear{0%{transform:scale(0)}50%{transform:scale(1.1)}100%{transform:scale(1)}}

.overlay{
  position:absolute;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);
  border-radius:var(--radius);display:flex;flex-direction:column;
  align-items:center;justify-content:center;z-index:10;
  opacity:0;pointer-events:none;transition:opacity .3s
}
.overlay.show{opacity:1;pointer-events:auto}
.overlay h2{font-size:2rem;margin-bottom:12px;color:var(--accent)}
.overlay .sub{color:var(--text2);margin-bottom:16px}
.overlay .btn{margin:4px;padding:12px 24px}

.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(8px);
  display:flex;align-items:center;justify-content:center;z-index:100;
  opacity:0;pointer-events:none;transition:opacity .3s
}
.modal.show{opacity:1;pointer-events:auto}
.modal-box{background:var(--bg2);border-radius:16px;padding:24px;max-width:320px;width:90%}
.modal-box h3{margin-bottom:16px;text-align:center;color:var(--accent)}
.theme-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.theme-btn{
  padding:12px;border-radius:8px;border:2px solid transparent;
  cursor:pointer;font-weight:600;font-size:.8rem;transition:all .15s
}
.theme-btn:hover{transform:scale(1.03)}
.theme-btn.active{border-color:var(--accent)}
.theme-btn[data-theme="default"]{background:#1a1a1a;color:#0ea5e9}
.theme-btn[data-theme="light"]{background:#e5e5e5;color:#0ea5e9}
.theme-btn[data-theme="neon"]{background:#1e0030;color:#ff00ff}
.theme-btn[data-theme="ocean"]{background:#002842;color:#00b4d8}
.theme-btn[data-theme="sunset"]{background:#2d1600;color:#ff6b35}
.theme-btn[data-theme="forest"]{background:#002d14;color:#4ade80}
.theme-btn[data-theme="galaxy"]{background:#180028;color:#a855f7}
.theme-btn[data-theme="retro"]{background:#262626;color:#facc15}
.modal-close{margin-top:16px;width:100%}

.stats{display:flex;gap:20px;margin-top:14px;font-size:.75rem;color:var(--text2)}
</style>
</head>
<body>
<div class="header">
  <div class="logo"><span>RF</span>2048</div>
  <div class="scores">
    <div class="score-box"><div class="label">Score</div><div class="val" id="score">0</div></div>
    <div class="score-box"><div class="label">Best</div><div class="val" id="best">0</div></div>
  </div>
</div>
<div class="controls">
  <button class="btn" id="btnNew">New Game</button>
  <button class="btn" id="btnUndo">‚Ü© Undo</button>
  <button class="btn btn-icon" id="btnTheme" title="Theme">üé®</button>
  <button class="btn btn-icon" id="btnSound" title="Sound">üîä</button>
</div>
<div class="board-wrap" id="wrap">
  <div class="board" id="board"></div>
  <div class="tile-layer" id="tileLayer"></div>
  <div class="overlay" id="winOverlay"><h2>You Win! üéâ</h2><div><button class="btn" id="btnKeep">Keep Playing</button><button class="btn" id="btnNewW">New Game</button></div></div>
  <div class="overlay" id="loseOverlay"><h2>Game Over</h2><div class="sub">Score: <span id="finalScore">0</span></div><button class="btn" id="btnNewL">Try Again</button></div>
</div>
<div class="stats">
  <span>üéØ <span id="statMoves">0</span> moves</span>
  <span>‚è±Ô∏è <span id="statTime">0:00</span></span>
  <span>üèÜ <span id="statMax">0</span></span>
</div>

<div class="modal" id="themeModal">
  <div class="modal-box">
    <h3>üé® Theme</h3>
    <div class="theme-grid">
      <button class="theme-btn active" data-theme="default">‚ö° RF Dark</button>
      <button class="theme-btn" data-theme="light">‚òÄÔ∏è Light</button>
      <button class="theme-btn" data-theme="neon">üíú Neon</button>
      <button class="theme-btn" data-theme="ocean">üåä Ocean</button>
      <button class="theme-btn" data-theme="sunset">üåÖ Sunset</button>
      <button class="theme-btn" data-theme="forest">üå≤ Forest</button>
      <button class="theme-btn" data-theme="galaxy">üåå Galaxy</button>
      <button class="theme-btn" data-theme="retro">üïπÔ∏è Retro</button>
    </div>
    <button class="btn modal-close" id="closeModal">Done</button>
  </div>
</div>

<script>
(()=>{
// Theme-specific tile colors - EVERY number is completely unique and distinct
const THEMES={
  default:{
    2:['#f0e6d3','#6b5c4c'],     // beige
    4:['#f7cba0','#6b5c4c'],     // peach
    8:['#f59e42','#fff'],        // orange
    16:['#e74c3c','#fff'],       // red
    32:['#c0392b','#fff'],       // dark red
    64:['#9b59b6','#fff'],       // purple
    128:['#3498db','#fff'],      // blue
    256:['#1abc9c','#fff'],      // teal
    512:['#27ae60','#fff'],      // green
    1024:['#f1c40f','#fff'],     // yellow
    2048:['#e91e63','#fff'],     // pink
    4096:['#00bcd4','#fff'],     // cyan
    8192:['#673ab7','#fff'],     // deep purple
    16384:['#ff5722','#fff'],    // deep orange
    32768:['#607d8b','#fff'],    // blue grey
    65536:['#795548','#fff'],    // brown
    131072:['#000000','#fff']    // black
  },
  light:{
    2:['#e8e0d6','#5c534a'],4:['#ffd9a0','#5c534a'],8:['#ffab40','#fff'],
    16:['#ff5252','#fff'],32:['#d32f2f','#fff'],64:['#aa00ff','#fff'],
    128:['#2979ff','#fff'],256:['#00bfa5','#fff'],512:['#00c853','#fff'],
    1024:['#ffd600','#333'],2048:['#f50057','#fff'],4096:['#00e5ff','#333'],
    8192:['#7c4dff','#fff'],16384:['#ff3d00','#fff'],32768:['#455a64','#fff'],
    65536:['#6d4c41','#fff'],131072:['#212121','#fff']
  },
  neon:{
    2:['#ff00ff','#fff'],        // magenta
    4:['#00ffff','#000'],        // cyan
    8:['#ffff00','#000'],        // yellow
    16:['#ff0000','#fff'],       // red
    32:['#00ff00','#000'],       // green
    64:['#0000ff','#fff'],       // blue
    128:['#ff8800','#fff'],      // orange
    256:['#8800ff','#fff'],      // violet
    512:['#00ff88','#000'],      // mint
    1024:['#ff0088','#fff'],     // hot pink
    2048:['#88ff00','#000'],     // lime
    4096:['#0088ff','#fff'],     // sky blue
    8192:['#ff00aa','#fff'],     // pink
    16384:['#aaff00','#000'],    // yellow-green
    32768:['#00aaff','#fff'],    // light blue
    65536:['#ff5500','#fff'],    // red-orange
    131072:['#ffffff','#000']    // white
  },
  ocean:{
    2:['#e0f7fa','#004d66'],4:['#80deea','#004d66'],8:['#26c6da','#fff'],
    16:['#00acc1','#fff'],32:['#00838f','#fff'],64:['#006978','#fff'],
    128:['#0097a7','#fff'],256:['#00796b','#fff'],512:['#004d40','#fff'],
    1024:['#1de9b6','#004d40'],2048:['#64ffda','#004d40'],4096:['#18ffff','#004d40'],
    8192:['#84ffff','#004d40'],16384:['#a7ffeb','#004d40'],32768:['#b2ebf2','#004d66'],
    65536:['#e0f2f1','#004d40'],131072:['#ffffff','#004d40']
  },
  sunset:{
    2:['#fff8e1','#4e342e'],4:['#ffe082','#4e342e'],8:['#ffc107','#fff'],
    16:['#ff9800','#fff'],32:['#ff5722','#fff'],64:['#f44336','#fff'],
    128:['#e91e63','#fff'],256:['#9c27b0','#fff'],512:['#673ab7','#fff'],
    1024:['#3f51b5','#fff'],2048:['#2196f3','#fff'],4096:['#03a9f4','#fff'],
    8192:['#00bcd4','#fff'],16384:['#009688','#fff'],32768:['#4caf50','#fff'],
    65536:['#8bc34a','#fff'],131072:['#cddc39','#333']
  },
  forest:{
    2:['#f1f8e9','#33691e'],4:['#dcedc8','#33691e'],8:['#aed581','#fff'],
    16:['#8bc34a','#fff'],32:['#689f38','#fff'],64:['#558b2f','#fff'],
    128:['#33691e','#fff'],256:['#827717','#fff'],512:['#9e9d24','#fff'],
    1024:['#c0ca33','#333'],2048:['#ffeb3b','#333'],4096:['#ffc107','#333'],
    8192:['#ff9800','#fff'],16384:['#ff5722','#fff'],32768:['#795548','#fff'],
    65536:['#607d8b','#fff'],131072:['#9e9e9e','#333']
  },
  galaxy:{
    2:['#ede7f6','#311b92'],4:['#d1c4e9','#311b92'],8:['#b39ddb','#fff'],
    16:['#9575cd','#fff'],32:['#7e57c2','#fff'],64:['#673ab7','#fff'],
    128:['#5e35b1','#fff'],256:['#512da8','#fff'],512:['#4527a0','#fff'],
    1024:['#311b92','#fff'],2048:['#e91e63','#fff'],4096:['#f44336','#fff'],
    8192:['#ff9800','#fff'],16384:['#ffeb3b','#311b92'],32768:['#4caf50','#fff'],
    65536:['#00bcd4','#fff'],131072:['#2196f3','#fff']
  },
  retro:{
    2:['#fff9c4','#5d4037'],4:['#fff176','#5d4037'],8:['#ffee58','#5d4037'],
    16:['#ffca28','#5d4037'],32:['#ffa726','#fff'],64:['#ff7043','#fff'],
    128:['#ec407a','#fff'],256:['#ab47bc','#fff'],512:['#7e57c2','#fff'],
    1024:['#5c6bc0','#fff'],2048:['#42a5f5','#fff'],4096:['#29b6f6','#fff'],
    8192:['#26c6da','#fff'],16384:['#26a69a','#fff'],32768:['#66bb6a','#fff'],
    65536:['#9ccc65','#333'],131072:['#d4e157','#333']
  }
};

let grid,score,best,prev,won,keepGoing,moves,startTime,timer,sound=true,theme='default';

function getColor(v){
  const palette=THEMES[theme]||THEMES.default;
  return palette[v]||['#0ea5e9','#fff'];
}
function fontSize(v,s){
  if(v<100)return s*.5;if(v<1000)return s*.4;
  if(v<10000)return s*.32;if(v<100000)return s*.26;return s*.22;
}
const $=id=>document.getElementById(id);
const $board=$('board'),$tiles=$('tileLayer'),$wrap=$('wrap');

// Create cells
for(let i=0;i<16;i++){const c=document.createElement('div');c.className='cell';$board.appendChild(c)}

// Audio
let ctx;
function beep(freq,dur,type='sine',vol=.1){
  if(!sound)return;
  if(!ctx)ctx=new(window.AudioContext||window.webkitAudioContext)();
  if(ctx.state==='suspended')ctx.resume();
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.type=type;o.frequency.value=freq;g.gain.value=vol;
  o.connect(g);g.connect(ctx.destination);
  o.start();o.stop(ctx.currentTime+dur);
}

function init(){
  grid=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];
  score=0;won=false;keepGoing=false;prev=null;moves=0;
  best=+(localStorage.getItem('rf2048_best')||0);
  theme=localStorage.getItem('rf2048_theme')||'default';
  applyTheme(theme);
  $('winOverlay').classList.remove('show');
  $('loseOverlay').classList.remove('show');
  spawn();spawn();
  render();
  startTime=Date.now();
  clearInterval(timer);
  timer=setInterval(tick,1000);
  updateStats();
}

function tick(){
  const s=Math.floor((Date.now()-startTime)/1000);
  $('statTime').textContent=Math.floor(s/60)+':'+(s%60<10?'0':'')+(s%60);
}

function updateStats(){
  $('statMoves').textContent=moves;
  $('statMax').textContent=Math.max(...grid.flat());
}

function save(){prev={g:grid.map(r=>[...r]),s:score,m:moves}}
function undo(){
  if(!prev)return;
  grid=prev.g;score=prev.s;moves=prev.m;prev=null;
  $('winOverlay').classList.remove('show');
  $('loseOverlay').classList.remove('show');
  render();updateStats();
}

function spawn(){
  const e=[];
  for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(!grid[r][c])e.push([r,c]);
  if(!e.length)return null;
  const[r,c]=e[Math.random()*e.length|0];
  grid[r][c]=Math.random()<.9?2:4;
  return[r,c];
}

function render(merged=[],spawned=null){
  $('score').textContent=score.toLocaleString();
  if(score>best){best=score;localStorage.setItem('rf2048_best',best)}
  $('best').textContent=best.toLocaleString();
  
  // Clear old tiles
  $tiles.innerHTML='';
  
  // Get cell dimensions from actual grid
  const cells=$board.querySelectorAll('.cell');
  if(!cells.length)return;
  const rect0=cells[0].getBoundingClientRect();
  const wrapRect=$tiles.getBoundingClientRect();
  const cellSize=rect0.width;
  const gap=cells[1]?cells[1].getBoundingClientRect().left-rect0.right:12;
  
  for(let r=0;r<4;r++)for(let c=0;c<4;c++){
    const v=grid[r][c];
    if(!v)continue;
    
    const tile=document.createElement('div');
    tile.className='tile';
    
    // Check animations
    if(merged.some(p=>p[0]===r&&p[1]===c))tile.classList.add('pop');
    if(spawned&&spawned[0]===r&&spawned[1]===c)tile.classList.add('appear');
    
    const[bg,fg]=getColor(v);
    const top=r*(cellSize+gap);
    const left=c*(cellSize+gap);
    
    tile.style.cssText=`
      top:${top}px;left:${left}px;
      width:${cellSize}px;height:${cellSize}px;
      background:${bg};color:${fg};
      font-size:${fontSize(v,cellSize)}px;
    `;
    tile.textContent=v;
    $tiles.appendChild(tile);
  }
}

function move(dir){
  if($('winOverlay').classList.contains('show')||$('loseOverlay').classList.contains('show'))return;
  save();
  let moved=false;
  const merged=[];
  const vertical=dir==='up'||dir==='down';
  const reverse=dir==='down'||dir==='right';
  
  for(let i=0;i<4;i++){
    let line=[];
    for(let j=0;j<4;j++){
      const r=vertical?(reverse?3-j:j):i;
      const c=vertical?i:(reverse?3-j:j);
      line.push(grid[r][c]);
    }
    line=line.filter(Boolean);
    const result=[];
    for(let k=0;k<line.length;k++){
      if(k+1<line.length&&line[k]===line[k+1]){
        const val=line[k]*2;
        result.push(val);
        score+=val;
        if(val===2048&&!won)won=true;
        const pos=reverse?3-result.length+1:result.length-1;
        merged.push(vertical?[pos,i]:[i,pos]);
        k++;
      }else result.push(line[k]);
    }
    while(result.length<4)result.push(0);
    for(let j=0;j<4;j++){
      const idx=reverse?3-j:j;
      const r=vertical?idx:i;
      const c=vertical?i:idx;
      if(grid[r][c]!==result[j])moved=true;
      grid[r][c]=result[j];
    }
  }
  
  if(!moved){prev=null;return}
  
  moves++;
  beep(merged.length?600:300,.06);
  const spawned=spawn();
  render(merged,spawned);
  updateStats();
  
  if(won&&!keepGoing){
    $('winOverlay').classList.add('show');
    beep(523,.1);setTimeout(()=>beep(659,.1),100);setTimeout(()=>beep(784,.15),200);
  }else if(isOver()){
    $('loseOverlay').classList.add('show');
    $('finalScore').textContent=score.toLocaleString();
    beep(200,.3,'sawtooth');
    clearInterval(timer);
  }
}

function isOver(){
  for(let r=0;r<4;r++)for(let c=0;c<4;c++){
    if(!grid[r][c])return false;
    if(c<3&&grid[r][c]===grid[r][c+1])return false;
    if(r<3&&grid[r][c]===grid[r+1][c])return false;
  }
  return true;
}

function applyTheme(t){
  document.body.className=t==='default'?'':'theme-'+t;
  theme=t;
  localStorage.setItem('rf2048_theme',t);
  document.querySelectorAll('.theme-btn').forEach(b=>b.classList.toggle('active',b.dataset.theme===t));
  render();
}

// Events
document.addEventListener('keydown',e=>{
  const map={ArrowUp:'up',ArrowDown:'down',ArrowLeft:'left',ArrowRight:'right',w:'up',s:'down',a:'left',d:'right'};
  if(map[e.key]){e.preventDefault();move(map[e.key])}
});

let tx,ty;
$wrap.addEventListener('touchstart',e=>{tx=e.touches[0].clientX;ty=e.touches[0].clientY},{passive:true});
$wrap.addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-tx,dy=e.changedTouches[0].clientY-ty;
  if(Math.abs(dx)<30&&Math.abs(dy)<30)return;
  move(Math.abs(dx)>Math.abs(dy)?(dx>0?'right':'left'):(dy>0?'down':'up'));
},{passive:true});

$('btnNew').onclick=$('btnNewW').onclick=$('btnNewL').onclick=init;
$('btnUndo').onclick=undo;
$('btnKeep').onclick=()=>{keepGoing=true;$('winOverlay').classList.remove('show')};
$('btnTheme').onclick=()=>$('themeModal').classList.add('show');
$('closeModal').onclick=()=>$('themeModal').classList.remove('show');
$('themeModal').onclick=e=>{if(e.target.id==='themeModal')$('themeModal').classList.remove('show')};
$('btnSound').onclick=()=>{sound=!sound;$('btnSound').textContent=sound?'üîä':'üîá'};
document.querySelectorAll('.theme-btn').forEach(b=>b.onclick=()=>applyTheme(b.dataset.theme));

window.addEventListener('resize',()=>render());
init();
})();
</script>
</body>
</html>
